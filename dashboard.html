<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® - User Dashboard</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Firebase (compat as in your original) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
  /* ========= Base ========= */
  :root{
    --primary: #d32f2f;
    --primary-dark: #b71c1c;
    --primary-light: #ff6659;
    --secondary: #1976d2;
    --danger: #c62828;
    --success: #2e7d32;
    --warning: #f57c00;
    --muted: #757575;
    --card-bg: #ffffff;
    --bg: #fbe9e7;
    --radius: 12px;
    --glass: rgba(255,255,255,0.7);
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:'Noto Sans Bengali',sans-serif}
  body{background: linear-gradient(to bottom, #fbe9e7, #ffccbc); color:#333; min-height:100vh;}

  /* ========= Layout ========= */
  .container{max-width:100%;margin:0 auto;padding:0 20px;}
  .grid{
    display:grid;grid-template-columns:1fr 340px;gap:18px;
  }
  /* Mobile single column */
  @media(max-width:980px){ 
    .grid{grid-template-columns:1fr} 
    .right-col{order:2} 
    .left-col{order:1} 
  }

  /* ========= Hero Section ========= */
  .hero-section {
    background: linear-gradient(135deg, rgba(211, 47, 47, 0.9), rgba(183, 28, 28, 0.85)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="rgba(255,255,255,0.1)"/><path d="M0 0L100 100" stroke="rgba(255,255,255,0.1)" stroke-width="2"/><path d="M100 0L0 100" stroke="rgba(255,255,255,0.1)" stroke-width="2"/></svg>');
    color: white;
    padding: 60px 20px;
    text-align: center;
    margin-bottom: 30px;
    border-radius: 0 0 20px 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
  }
  
  .hero-content {
    max-width: 800px;
    margin: 0 auto;
  }
  
  .hero-title {
    font-size: 2.8rem;
    margin-bottom: 15px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }
  
  .animated-text {
    font-size: 1.8rem;
    min-height: 60px;
    margin-bottom: 25px;
    font-weight: 600;
  }
  
  .hero-subtitle {
    font-size: 1.2rem;
    margin-bottom: 30px;
    opacity: 0.9;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .hero-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
  }

  /* ========= Cards ========= */
  .card{
    background: var(--card-bg); 
    border-radius: var(--radius); 
    padding: 20px; 
    box-shadow: 0 8px 20px rgba(211, 47, 47, 0.12);
    overflow:hidden;
    margin-bottom: 20px;
    border-left: 4px solid var(--primary);
    transition: all 0.3s ease;
  }

  /* ========= Section Navigation ========= */
  .section-nav {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    background: white;
    padding: 12px;
    border-radius: var(--radius);
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    justify-content: center;
  }
  
  .nav-btn {
    background: transparent;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 4px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .nav-btn:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 3px;
    background: var(--primary);
    transition: all 0.3s ease;
  }
  
  .nav-btn:hover {
    background: rgba(211, 47, 47, 0.1);
    color: var(--primary);
  }
  
  .nav-btn:hover:after {
    width: 100%;
  }
  
  .nav-btn.active {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 12px rgba(211, 47, 47, 0.3);
  }
  
  .nav-btn.active:after {
    width: 100%;
    background: white;
  }

  /* ========= Hero ========= */
  .hero{
    display:flex;gap:16px;align-items:center;justify-content:space-between;
    flex-wrap:wrap;padding:18px;border-radius:12px;
    background: linear-gradient(135deg, rgba(211, 47, 47, 0.08), rgba(211, 47, 47, 0.04));
    margin-bottom: 20px;
  }
  .hero-left h1{font-size:22px;margin-bottom:8px;color: var(--primary-dark);}
  .hero-left p{color:var(--muted);font-size:14px; max-width: 600px;}
  .hero-cta{display:flex;gap:10px;align-items:center; margin-top: 15px;}
  .cta-btn{
    background:var(--primary);color:#fff;border:none;padding:12px 18px;border-radius:10px;cursor:pointer;font-weight:600;
    box-shadow:0 8px 20px rgba(211, 47, 47, 0.2);display:inline-flex;gap:8px;align-items:center;
    transition:transform .18s ease, box-shadow .18s ease;
  }
  .cta-btn:hover{transform:translateY(-3px);box-shadow:0 14px 30px rgba(183, 28, 28, 0.25)}
  .secondary-btn{
    background:transparent;
    color:var(--primary);
    border:1px solid rgba(211, 47, 47, 0.3);
    padding:10px 16px;
    border-radius:8px;
    transition: all 0.3s ease;
  }
  .secondary-btn:hover {
    background: rgba(211, 47, 47, 0.1);
  }

  /* ========= Features ========= */
  .features{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:20px}
  @media(max-width:900px){ .features{grid-template-columns:repeat(2,1fr)} }
  @media(max-width:520px){ .features{grid-template-columns:1fr} }
  .feature{
    background: linear-gradient(180deg, #fff, rgba(255,255,255,0.95)); 
    padding:16px;border-radius:12px;
    display:flex;gap:12px;align-items:flex-start;transition:transform .22s ease, box-shadow .22s ease;
    border: 1px solid rgba(211, 47, 47, 0.1);
  }
  .feature:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(211, 47, 47, 0.15)}
  .feature i{font-size:24px;color:var(--primary);min-width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;
    background: rgba(211, 47, 47, 0.1);}
  .feature h4{font-size:16px;margin-bottom:6px;color: var(--primary-dark);}
  .feature p{font-size:14px;color:var(--muted); line-height: 1.5;}

  /* ========= Right column (profile + stats) ========= */
  .profile{display:flex;gap:14px;align-items:center; margin-bottom: 20px;}
  .avatar{
    width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg, #ffcdd2, #fff);display:flex;align-items:center;justify-content:center;
    font-weight:700;font-size:24px;color:var(--primary); border: 2px solid var(--primary-light);
  }
  .stat{
    display:flex;flex-direction:column;gap:6px;margin-top:16px;
    padding: 12px;
    background: rgba(211, 47, 47, 0.05);
    border-radius: var(--radius);
  }
  .stat .val{font-size:20px;font-weight:700; color: var(--primary);}
  .stat .label{font-size:14px;color:var(--muted);}

  /* ========= Request section ========= */
  .request-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px; align-items: center;}
  button.actionBtn{
    padding:12px 18px;
    background:var(--primary);
    color:#fff;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-size:16px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
  }
  button.actionBtn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(183, 28, 28, 0.3);
  }
  button.actionBtn[disabled]{
    opacity:0.6;cursor:not-allowed;transform:none;
    background: var(--muted);
    box-shadow: none;
  }
  .status-pill{
    display:inline-block;
    padding:8px 14px;
    border-radius:999px;
    font-weight:700;
    font-size:14px;
  }
  .status-pending{background:#fff2cc;color:#8a5d00;border:1px solid #ffe5a3}
  .status-confirmed{background:#e6ffef;color:#046a3b;border:1px solid #bff7d0}
  .status-rejected{background:#ffecec;color:#7a1515;border:1px solid #f4b6b6}

  /* Animated pulse for pending */
  @keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.18); }
    70% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
  }
  .pulse { animation: pulse 2s infinite; border-radius:999px; }

  /* Request history list */
  .history-item{
    display:flex;
    justify-content:space-between;
    gap:12px;
    padding:12px;
    border-radius:8px;
    border:1px dashed rgba(211, 47, 47, 0.2);
    margin-top:10px;
    background: rgba(211, 47, 47, 0.03);
    transition: all 0.3s ease;
  }
  .history-item:hover {
    background: rgba(211, 47, 47, 0.08);
    transform: translateX(5px);
  }
  .history-item small{color:var(--muted)}

  /* small text */
  .muted{color:var(--muted);font-size:14px}

  /* Footer small */
  .page-footer{
    margin-top:20px;
    text-align:center;
    color:var(--muted);
    font-size:14px;
    padding: 12px;
    background: rgba(211, 47, 47, 0.05);
    border-radius: var(--radius);
  }
  
  #needDonate{
    background: var(--success);
    margin-top:10px;
  }
  
  #needDonate:hover {
    background: #1b5e20;
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(46, 125, 50, 0.3);
  }
  
  h3 {
    color: var(--primary-dark);
    margin-bottom: 10px;
    font-size: 22px;
    padding-bottom: 8px;
    border-bottom: 2px solid rgba(211, 47, 47, 0.2);
  }
  
  h4 {
    color: var(--primary-dark);
    margin-bottom: 10px;
    font-size: 18px;
  }
  
  .info-box {
    background: rgba(211, 47, 47, 0.05);
    padding: 15px;
    border-radius: var(--radius);
    margin: 15px 0;
    border-left: 3px solid var(--primary);
  }
  
  .user-stats {
    display: flex;
    gap: 15px;
    margin: 15px 0;
    flex-wrap: wrap;
  }
  
  .stat-box {
    flex: 1;
    min-width: 150px;
    padding: 12px;
    background: rgba(211, 47, 47, 0.05);
    border-radius: var(--radius);
    text-align: center;
  }
  
  .stat-value {
    font-size: 20px;
    font-weight: bold;
    color: var(--primary);
  }
  
  .stat-label {
    font-size: 14px;
    color: var(--muted);
  }
  
  /* Notice Section */
  .notice-container {
    margin: 20px 0;
  }
  
  .notice-item {
    background: rgba(255, 249, 196, 0.5);
    border-left: 4px solid #ffc107;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
  }
  
  .notice-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
  }
  
  .notice-title {
    font-weight: 600;
    color: #7d6608;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .notice-content {
    color: #8d6e10;
    font-size: 14px;
  }
  
  .notice-date {
    font-size: 12px;
    color: #b2a05d;
    text-align: right;
    margin-top: 8px;
  }
  
  /* Animation for text changing */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .fade-in {
    animation: fadeIn 1s ease forwards;
  }
  
  /* Section transition */
  .section {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease, transform 0.5s ease;
    display: none;
  }
  
  .section.active {
    opacity: 1;
    transform: translateY(0);
    display: block;
  }
  #needDonateHero{
    background:purple;
  }
  #heroDonateBtn{
   background: yellow;
   color:black;
  }
  .popup-overlay{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:999;
}
.popup-content{
  background:#fff;
  border-radius:15px;
  padding:30px;
  max-width:400px;
  width:90%;
  text-align:center;
  position:relative;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
}
.popup-content img{
  display:block;
  margin:0 auto 20px auto;
  width:120px;
  height:120px;
  border-radius:50%;
  object-fit:cover;
  border:3px solid #d32f2f;
}
.popup-content h2{
  color:#b71c1c;
  margin-bottom:15px;
}
.popup-content p{
  margin:8px 0;
  font-size:15px;
  color:#333;
}
.label{
  font-weight:600;
  color:#b71c1c;
}
.close-btn{
  position:absolute;
  top:10px; right:15px;
  font-size:22px;
  cursor:pointer;
  color:#b71c1c;
}
</style>
</head>
<body>

<div id="founderPopup" class="popup-overlay" style="display:none;">
  <div class="popup-content">
    <span class="close-btn" id="closePopup">&times;</span>
    <img id="founderPhoto" src="" alt="Founder Photo">
    <h2>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶§‡¶æ ‡¶§‡¶•‡ßç‡¶Ø</h2>
    <p><span class="label">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶§‡¶æ:</span> <span id="founderName">...</span></p>
    <p id="founderDescription" style="margin:8px 0;"></p>
    <p><span class="label">Contact:</span> <span id="founderContact">...</span></p>
  </div>
</div>


<!-- ===== HERO SECTION ===== -->
<div class="hero-section">
  <div class="hero-content">
    <h1 class="hero-title">‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶¨‡¶æ‡¶Å‡¶ö‡¶æ‡¶®</h1>
    <div class="animated-text" id="changing-text">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶¨‡¶æ‡¶Å‡¶ö‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá</div>
    <p class="hero-subtitle">‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® ‡¶Æ‡¶π‡¶æ‡¶®‡ßÅ‡¶≠‡¶¨‡¶§‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú‡•§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶õ‡ßã‡¶ü‡ßç‡¶ü ‡¶Ö‡¶¨‡¶¶‡¶æ‡¶® ‡¶ï‡¶æ‡¶∞‡ßã ‡¶ú‡¶®‡ßç‡¶Ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá ‡¶ú‡ßÄ‡¶¨‡¶®‡¶¶‡¶æ‡¶®‡•§ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶∏‡¶π‡¶ú‡ßá‡¶á ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶¨‡¶Ç ‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶® ‡¶π‡¶≤‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§</p>
    <div class="hero-buttons">
      <button class="cta-btn" id="heroDonateBtn"><i class="fa-solid fa-hand-holding-droplet"></i> ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      <a href="need_donate.html">
        <button class="cta-btn" id="needDonateHero"><i class="fa-solid fa-tint"></i> ‡¶∞‡¶ï‡ßç‡¶§‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      </a>
    </div>
  </div>
</div>

<!-- ===== MAIN CONTAINER ===== -->
<div class="container">
  <!-- Section Navigation -->
  <div class="section-nav">
    <button class="nav-btn active" data-section="homeSection"><i class="fa-solid fa-house"></i> ‡¶π‡ßã‡¶Æ</button>
    <button class="nav-btn" data-section="requestSection"><i class="fa-solid fa-hand-holding-droplet"></i> ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®</button>
    <button class="nav-btn" data-section="historySection"><i class="fa-solid fa-clock-rotate-left"></i> ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</button>
    <button class="nav-btn" data-section="noticeSection"><i class="fa-solid fa-bullhorn"></i> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂</button>
    <button class="nav-btn" onclick="logout()" style="margin-left: auto;"><i class="fa-solid fa-sign-out-alt"></i> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
  </div>

  <div class="grid">

    <!-- LEFT / MAIN COLUMN -->
    <div class="left-col">

      <!-- HOME (default) -->
      <div id="homeSection" class="card section active">
        <div class="hero">
          <div class="hero-left">
            <h1 id="welcomeTitle">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ</h1>
            <p id="welcomeSub">‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®‡ßá ‡¶Ö‡¶Ç‡¶∂‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶æ‡¶∞‡ßã ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§ ‡¶®‡¶ø‡¶ö‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶ì ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶ø‡¶ï‡¶æ ‡¶Ü‡¶õ‡ßá‡•§</p>
            <div class="hero-cta">
              <button class="cta-btn" id="goRequestFromHero"><i class="fa-solid fa-hand-holding-droplet"></i> ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
              <a href="need_donate.html">
                <button class="cta-btn" id="needDonate"><i class="fa-solid fa-tint"></i> ‡¶∞‡¶ï‡ßç‡¶§‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
              </a>
            </div>
          </div>
          <div class="hero-right" style="min-width:220px;text-align:right">
            <div style="font-size:14px;color:var(--muted)">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶®</div>
            <div style="display:flex;gap:12px;justify-content:flex-end;margin-top:12px">
              <div style="text-align:center">
                <div class="val" id="stat-donations">0</div>
                <div class="muted" style="font-size:14px">‡¶°‡ßã‡¶®‡ßá‡¶∂‡¶®</div>
              </div>
              <div style="text-align:center">
                <div class="val" id="stat-last-days">--</div>
                <div class="muted" style="font-size:14px">‡¶∂‡ßá‡¶∑ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® (‡¶¶‡¶ø‡¶®)</div>
              </div>
            </div>
          </div>
        </div>

        <!-- User Stats -->
        <div class="user-stats">
          <div class="stat-box">
            <div class="stat-value" id="user-blood-display">--</div>
            <div class="stat-label">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="user-location-display">--</div>
            <div class="stat-label">‡¶ú‡ßá‡¶≤‡¶æ/‡¶â‡¶™‡¶ú‡ßá‡¶≤‡¶æ</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="user-last-donate-display">--</div>
            <div class="stat-label">‡¶∂‡ßá‡¶∑ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®</div>
          </div>
        </div>

        <!-- Features -->
        <div class="features">
          <div class="feature">
            <i class="fa-solid fa-heart-pulse"></i>
            <div>
              <h4>‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®</h4>
              <p>‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶ì ‡¶∏‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶ü‡¶æ‡¶á‡¶ú‡¶°‡•§ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡•§</p>
            </div>
          </div>
          <div class="feature">
            <i class="fa-solid fa-people-group"></i>
            <div>
              <h4>‡¶ï‡¶Æ‡¶ø‡¶â‡¶®‡¶ø‡¶ü‡¶ø ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</h4>
              <p>‡¶Ü‡¶™‡¶®‡¶ø ‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßÄ‡¶Ø‡¶º ‡¶π‡¶æ‡¶∏‡¶™‡¶æ‡¶§‡¶æ‡¶≤ ‡¶¨‡¶æ ‡¶∞‡ßã‡¶ó‡ßÄ‡¶ï‡ßá ‡¶∏‡¶π‡¶æ‡¶Ø‡¶º‡¶§‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡•§</p>
            </div>
          </div>
          <div class="feature">
            <i class="fa-solid fa-truck-medical"></i>
            <div>
              <h4>‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶∏‡ßá‡¶¨‡¶æ</h4>
              <p>‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞‡ßá ‡¶¶‡¶æ‡¶§‡¶æ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡•§</p>
            </div>
          </div>
        </div>

        <!-- Donation tips -->
        <div class="info-box">
          <div style="display:flex;gap:12px;align-items:flex-start;">
            <div style="font-size:24px;color:var(--primary);margin-top:2px"><i class="fa-solid fa-lightbulb"></i></div>
            <div>
              <h4 style="margin-bottom:8px">‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶∏‡¶π‡¶ú ‡¶ü‡¶ø‡¶™‡¶∏</h4>
              <p class="muted">‡¶∞‡¶ï‡ßç‡¶§ ‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶ú‡¶≤ ‡¶ñ‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ, ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡¶æ, ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡¶ø‡¶∂‡ßç‡¶∞‡¶æ‡¶Æ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶â‡¶ö‡¶ø‡¶§‡•§ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶∏‡ßç‡¶¨‡¶æ‡¶∏‡ßç‡¶•‡ßç‡¶Ø ‡¶∂‡¶∞‡ßç‡¶§ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
            </div>
          </div>
        </div>
      </div>

      <!-- REQUEST PAGE -->
      <div id="requestSection" class="card section">
        <h3>‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</h3>
        <p class="muted" id="requestIntro">‡¶Ü‡¶™‡¶®‡¶ø ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‚Äî ‡¶§‡¶¨‡ßá ‡¶Ø‡¶¶‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü <b>pending</b> ‡¶•‡¶æ‡¶ï‡ßá, ‡¶§‡¶ñ‡¶® ‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§</p>

        <div class="user-stats">
          <div class="stat-box">
            <div class="stat-value" id="userBlood">--</div>
            <div class="stat-label">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="userLocation">--</div>
            <div class="stat-label">‡¶ú‡ßá‡¶≤‡¶æ/‡¶â‡¶™‡¶ú‡ßá‡¶≤‡¶æ</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="userLastDonate">--</div>
            <div class="stat-label">‡¶∂‡ßá‡¶∑ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®</div>
          </div>
        </div>

        <div class="request-actions">
          <button id="sendRequestBtn" class="actionBtn"><i class="fa-solid fa-paper-plane"></i> ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
          <div id="statusPillWrap" style="align-self:center"></div>
        </div>

        <div style="margin-top:20px">
          <h4>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ (‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ 5)</h4>
          <div id="requestHistory"></div>
        </div>

        <div class="page-footer">‡¶®‡ßã‡¶ü: ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶™‡¶∞‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶æ‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá Confirmed/Rejected ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§</div>
      </div>

      <!-- HISTORY -->
      <div id="historySection" class="card section">
        <h3>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</h3>
        <div id="fullHistory" style="margin-top:15px"></div>
      </div>
      
      <!-- NOTICE SECTION -->
      <div id="noticeSection" class="card section">
        <h3><i class="fa-solid fa-bullhorn"></i> ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¨‡ßã‡¶∞‡ßç‡¶°</h3>
        <p class="muted">‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ò‡ßã‡¶∑‡¶£‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶§‡¶•‡ßç‡¶Ø</p>
        
        <div class="notice-container" id="noticeContainer">
          <div class="notice-item">
            <div class="notice-title"><i class="fa-solid fa-info-circle"></i> ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ ‡¶®‡ßã‡¶ü‡¶ø‡¶∂</div>
            <div class="notice-content">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ‡•§ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶¨‡¶æ‡¶Å‡¶ö‡¶æ‡¶®‡ßã‡¶∞ ‡¶è‡¶á ‡¶Æ‡¶π‡ßé ‡¶ï‡¶æ‡¶ú‡ßá ‡¶Ö‡¶Ç‡¶∂ ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡•§</div>
            <div class="notice-date">‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ‡ßß ‡¶ú‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø, ‡ß®‡ß¶‡ß®‡ß©</div>
          </div>
        </div>
      </div>

    </div>

    <!-- RIGHT COLUMN -->
    <div class="right-col">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div class="profile">
            <div class="avatar" id="avatarInitials">A</div>
            <div>
              <div id="userFullname" style="font-weight:700">--</div>
              <div class="muted" id="userPhone">--</div>
            </div>
          </div>
          <div style="text-align:right">
            <div class="muted">‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</div>
            <div id="quickStatus" style="margin-top:6px"><span class="status-pill status-pending pulse" id="quickStatusPill">Loading</span></div>
          </div>
        </div>

        <div class="stat">
          <div class="val" id="statTotalRequests">0</div>
          <div class="label muted">‡¶Æ‡ßã‡¶ü ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</div>
        </div>

        
        <div style="margin-top:16px">
          <h4 style="margin-bottom:10px">‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</h4>
          <div style="display:flex;gap:10px">
            <button class="actionBtn" id="quickRequestBtn"><i class="fa-solid fa-hand-holding-droplet"></i> ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</button>
            <button class="secondary-btn" id="quickHistoryBtn">‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
          </div>
        </div>
      </div>

      <div class="card">
        <h4>‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶§‡¶•‡ßç‡¶Ø</h4>
        <p class="muted" style="margin-top:8px">‡¶∞‡¶ï‡ßç‡¶§ ‡¶¶‡¶æ‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶∂‡¶∞‡ßç‡¶§: ‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§‡¶¨‡¶Ø‡¶º‡¶∏‡ßç‡¶ï, ‡¶∏‡ßÅ‡¶∏‡ßç‡¶• ‡¶∂‡¶∞‡ßÄ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶π‡¶æ‡¶∏‡¶™‡¶æ‡¶§‡¶æ‡¶≤‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßÄ‡¶Ø‡¶º ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶æ‡¶¨‡¶≤‡ßÄ ‡¶Æ‡ßá‡¶®‡ßá ‡¶ö‡¶≤‡¶æ‡•§</p>
        <div class="info-box" style="margin-top: 12px;">
          <h4 style="font-size: 16px; margin-bottom: 8px;"><i class="fa-solid fa-phone"></i> ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</h4>
          <p class="muted" id="emergencyNumber" style="margin: 0;">‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßá ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®: ‚Ä¶</p>
        </div>
      </div>

    </div>

  </div>
</div>

<script>
  // ===== Firebase Config (your config preserved) =====
  const firebaseConfig = {
    apiKey: "AIzaSyAqhLfmOfmP-_8DOcoEH7Ck7fMF9Id4vJ4",
    authDomain: "earn-project-5f892.firebaseapp.com",
    databaseURL: "https://earn-project-5f892-default-rtdb.firebaseio.com/",
    projectId: "earn-project-5f892",
    storageBucket: "earn-project-5f892.firebasestorage.app",
    messagingSenderId: "8457886057",
    appId: "1:8457886057:web:b5e01d0972d169f47085f8"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ===== Current User =====
  const donorData = JSON.parse(localStorage.getItem('donorData'));
  if(!donorData){
    alert("Login ‡¶ï‡¶∞‡ßÅ‡¶®!");
    window.location.href = "login.html";
  }
  const userId = donorData.phone;

  // DOM references
  const homeBtn = document.querySelector('[data-section="homeSection"]');
  const requestBtnNav = document.querySelector('[data-section="requestSection"]');
  const historyBtn = document.querySelector('[data-section="historySection"]');
  const noticeBtn = document.querySelector('[data-section="noticeSection"]');

  const homeSection = document.getElementById('homeSection');
  const requestSection = document.getElementById('requestSection');
  const historySection = document.getElementById('historySection');
  const noticeSection = document.getElementById('noticeSection');
  const goRequestFromHero = document.getElementById('goRequestFromHero');

  const sendRequestBtn = document.getElementById('sendRequestBtn');
  const statusPillWrap = document.getElementById('statusPillWrap');
  const requestHistory = document.getElementById('requestHistory');
  const fullHistory = document.getElementById('fullHistory');
  const noticeContainer = document.getElementById('noticeContainer');

  const userFullnameEl = document.getElementById('userFullname');
  const userPhoneEl = document.getElementById('userPhone');
  const avatarInitials = document.getElementById('avatarInitials');
  const userBlood = document.getElementById('userBlood');
  const userLocation = document.getElementById('userLocation');
  const userLastDonate = document.getElementById('userLastDonate');
  const statDonations = document.getElementById('stat-donations');
  const statLastDays = document.getElementById('stat-last-days');
  const statTotalRequests = document.getElementById('statTotalRequests');
  const quickStatusPill = document.getElementById('quickStatusPill');
  
  // Home page stats
  const userBloodDisplay = document.getElementById('user-blood-display');
  const userLocationDisplay = document.getElementById('user-location-display');
  const userLastDonateDisplay = document.getElementById('user-last-donate-display');

  // Hero section elements
  const changingText = document.getElementById('changing-text');
  const heroDonateBtn = document.getElementById('heroDonateBtn');
  const needDonateHero = document.getElementById('needDonateHero');

  // Text for hero animation
  const heroTexts = [
    "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶¨‡¶æ‡¶Å‡¶ö‡¶æ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá",
    "‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶Æ‡¶π‡¶æ‡¶®‡ßÅ‡¶≠‡¶¨‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®",
    "‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶∏‡¶Æ‡¶æ‡¶ú‡ßá‡¶∞ ‡¶™‡¶æ‡¶∂‡ßá ‡¶¶‡¶æ‡¶Å‡¶°‡¶º‡¶æ‡¶®",
    "‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶® - ‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡¶°‡¶º ‡¶¶‡¶æ‡¶®"
  ];
  let currentTextIndex = 0;

  // Function to animate text changes
  function animateTextChange() {
    changingText.classList.remove('fade-in');
    setTimeout(() => {
      changingText.textContent = heroTexts[currentTextIndex];
      changingText.classList.add('fade-in');
      currentTextIndex = (currentTextIndex + 1) % heroTexts.length;
    }, 500);
  }

  // Start text animation
  setInterval(animateTextChange, 3000);

  // quick action buttons
  document.getElementById('quickRequestBtn').addEventListener('click', ()=> { showSection('requestSection'); });
  document.getElementById('quickHistoryBtn').addEventListener('click', ()=> { showSection('historySection'); });
  heroDonateBtn.addEventListener('click', ()=> { showSection('requestSection'); });
  needDonateHero.addEventListener('click', ()=> { window.location.href = "need_donate.html"; });

  // logout
  function logout(){
    localStorage.removeItem('donorData');
    alert("‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®!");
    window.location.href = "login.html";
  }

  // initial profile fill
  function populateProfile(){
    userFullnameEl.innerText = donorData.fullname || "--";
    userPhoneEl.innerText = donorData.phone || "--";
    avatarInitials.innerText = (donorData.fullname || "U").split(" ").map(s=>s[0]).slice(0,2).join("").toUpperCase();
    userBlood.innerText = donorData.bloodGroup || "--";
    userLocation.innerText = (donorData.district || "--") + " / " + (donorData.upazila || "--");
    document.getElementById('welcomeTitle').innerText = `‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ, ${donorData.fullname || ''}!`;
    
    // Update home page stats
    userBloodDisplay.innerText = donorData.bloodGroup || "--";
    userLocationDisplay.innerText = (donorData.district || "--") + " / " + (donorData.upazila || "--");
  }

  // Utility: format date
  function formatDate(iso){
    try { return new Date(iso).toLocaleString(); } catch(e){ return iso; }
  }

  // ===== Request button logic - disable if any pending request for this user =====
  let currentPendingRequestKey = null;
  function checkUserRequestsLive(){
    // Listen for requests by this user to update status live
    const qRef = db.ref('requests').orderByChild('userId').equalTo(userId);
    qRef.on('value', snapshot=>{
      let latest = null;
      let total = 0;
      snapshot.forEach(snap=>{
        total++;
        const r = snap.val(); r._key = snap.key;
        // choose latest by requestDate
        if(!latest || new Date(r.requestDate) > new Date(latest.requestDate)) latest = r;
      });

      statTotalRequests.innerText = total;
      statDonations.innerText = donorData.totalDonations || 0;

      // show latest status pill and history preview
      requestHistory.innerHTML = "";
      const items = [];
      snapshot.forEach(snap=>{
        const r = snap.val(); r._key = snap.key;
        items.push(r);
      });
      // sort desc by date
      items.sort((a,b)=> new Date(b.requestDate) - new Date(a.requestDate));
      items.slice(0,5).forEach(it=>{
        const div = document.createElement('div');
        div.className = 'history-item';
        const left = document.createElement('div');
        left.innerHTML = `<div style="font-weight:700">${it.bloodGroup} ‚Äî ${it.district}/${it.upazila}</div><small>${formatDate(it.requestDate)}</small>`;
        const right = document.createElement('div');
        const st = document.createElement('span');
        st.className = 'status-pill ' + (it.status==='pending' ? 'status-pending pulse' : it.status==='confirmed' ? 'status-confirmed' : 'status-rejected');
        st.innerText = it.status.toUpperCase();
        right.appendChild(st);
        div.appendChild(left);
        div.appendChild(right);
        requestHistory.appendChild(div);
      });

      // full history
      fullHistory.innerHTML = "";
      items.forEach(it=>{
        const d = document.createElement('div');
        d.className = 'history-item';
        d.innerHTML = `<div><b>${it.bloodGroup}</b> ‚Äî ${it.district}/${it.upazila}<br><small>${formatDate(it.requestDate)}</small></div>
                       <div><span class="status-pill ${it.status==='pending'?'status-pending pulse':it.status==='confirmed'?'status-confirmed':'status-rejected'}">${it.status}</span><br><small style="display:block;margin-top:6px">${it.confirmedDate?formatDate(it.confirmedDate):''}</small></div>`;
        fullHistory.appendChild(d);
      });

      // decide sendRequestBtn state based on any pending
      const anyPending = items.some(i=>i.status === 'pending');
      if(anyPending){
        // show latest pending data
        const latestPending = items.find(i=>i.status==='pending');
        currentPendingRequestKey = latestPending ? latestPending._key : null;
        sendRequestBtn.disabled = true;
        sendRequestBtn.innerText = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶ß‡ßÄ‡¶® (Pending)";
        // show status pill
        statusPillWrap.innerHTML = `<span class="status-pill status-pending pulse">Pending</span>`;
        quickStatusPill.className = 'status-pill status-pending pulse';
        quickStatusPill.innerText = 'Pending';
      } else {
        currentPendingRequestKey = null;
        sendRequestBtn.disabled = false;
        sendRequestBtn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®';
        statusPillWrap.innerHTML = `<span class="status-pill status-confirmed">No pending</span>`;
        quickStatusPill.className = 'status-pill status-confirmed';
        quickStatusPill.innerText = 'Ready';
      }

      // show latest request's overall status in right column (if any)
      if(items.length>0){
        const latest = items[0];
        if(latest.status === 'pending'){
          quickStatusPill.className = 'status-pill status-pending pulse';
          quickStatusPill.innerText = 'Pending';
        } else if(latest.status === 'confirmed'){
          quickStatusPill.className = 'status-pill status-confirmed';
          quickStatusPill.innerText = 'Confirmed';
        } else {
          quickStatusPill.className = 'status-pill status-rejected';
          quickStatusPill.innerText = 'Rejected';
        }
      }

    });
  }

  // Load notices from Firebase
 
  // ... ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶ï‡ßã‡¶° ...

  // Load notices from Firebase - CORRECTED VERSION
  function loadNotices() {
    const noticesRef = db.ref('notices').orderByChild('date').limitToLast(5);
    noticesRef.on('value', snapshot => {
      const noticeContainer = document.getElementById('noticeContainer');
      noticeContainer.innerHTML = '';
      
      if (!snapshot.exists()) {
        noticeContainer.innerHTML = `
          <div class="notice-item">
            <div class="notice-title"><i class="fa-solid fa-info-circle"></i> ‡¶ï‡ßã‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶®‡ßá‡¶á</div>
            <div class="notice-content">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶ï‡ßã‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶®‡ßá‡¶á‡•§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡¶á ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá‡•§</div>
          </div>
        `;
        return;
      }
      
      const notices = [];
      snapshot.forEach(childSnapshot => {
        notices.push({ id: childSnapshot.key, ...childSnapshot.val() });
      });
      
      // Sort by date descending
      notices.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      // Display notices
      notices.forEach(notice => {
        const noticeElement = document.createElement('div');
        noticeElement.className = 'notice-item';
        noticeElement.innerHTML = `
          <div class="notice-title"><i class="fa-solid fa-bullhorn"></i> ${notice.title}</div>
          <div class="notice-content">${notice.content}</div>
          <div class="notice-date">‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ${formatDate(notice.date)}</div>
        `;
        noticeContainer.appendChild(noticeElement);
      });
    });
  }

  // ... ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶ï‡ßã‡¶°‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Ö‡¶Ç‡¶∂ ...

  // Send request (only if not pending)
  sendRequestBtn.addEventListener('click', ()=>{
    // double check there's no pending
    db.ref('requests').orderByChild('userId').equalTo(userId).once('value').then(snapshot=>{
      let anyPending = false;
      snapshot.forEach(snap=>{
        if(snap.val().status === 'pending') anyPending = true;
      });
      if(anyPending){
        alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶è‡¶ï‡¶ü‡¶ø pending ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶ó‡ßá ‡¶∏‡ßá‡¶ü‡¶ø‡¶∞ status ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§');
        return;
      }

      // push new request
      const reqRef = db.ref('requests').push();
      reqRef.set({
        userId,
        fullname: donorData.fullname,
        phone: donorData.phone,
        bloodGroup: donorData.bloodGroup || 'Unknown',
        district: donorData.district || '',
        upazila: donorData.upazila || '',
        status: "pending",
        requestDate: new Date().toISOString(),
        confirmedDate: null
      }).then(()=>{
        alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
      }).catch(err=>{
        console.error(err);
        alert("‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
      });
    });
  });

  // ===== Section navigation =====
  function showSection(sectionId){
    // Hide all sections
    document.querySelectorAll('.section').forEach(section => {
      section.classList.remove('active');
    });
    
    // Show selected section
    document.getElementById(sectionId).classList.add('active');
    
    // Update active button state
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.classList.remove('active');
      if(btn.getAttribute('data-section') === sectionId) {
        btn.classList.add('active');
      }
    });
    
    // scroll to top of container for better UX
    window.scrollTo({top: 0, behavior: 'smooth'});
  }

  // Add event listeners to nav buttons
  document.querySelectorAll('.nav-btn').forEach(btn => {
    if(btn.getAttribute('data-section')) {
      btn.addEventListener('click', () => {
        showSection(btn.getAttribute('data-section'));
      });
    }
  });

  // ===== initializations =====
  populateProfile();
  checkUserRequestsLive();
  loadNotices();

  // fill last donate info in profile area
  db.ref('donors/' + userId + '/lastDonateDate').once('value').then(snap=>{
    const last = snap.val();
    if(last){
      const diff = Math.floor((new Date() - new Date(last)) / (1000*60*60*24));
      userLastDonate.innerText = diff + " ‡¶¶‡¶ø‡¶® ‡¶Ü‡¶ó‡ßá";
      userLastDonateDisplay.innerText = diff + " ‡¶¶‡¶ø‡¶®";
      statLastDays.innerText = diff;
    } else {
      userLastDonate.innerText = "‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡¶ï‡ßç‡¶§ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡¶®‡¶ø";
      userLastDonateDisplay.innerText = "‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡ßá‡¶á";
      statLastDays.innerText = "--";
    }
  });

  // track total donations if stored
  db.ref('donors/' + userId + '/totalDonations').once('value').then(snap=>{
    const val = snap.val() || 0;
    document.getElementById('stat-donations').innerText = val;
  });

  // Ensure quick nav buttons reflect actions
  goRequestFromHero.addEventListener('click', ()=> showSection('requestSection'));

</script>
<script>
  function showSection(sectionId) {
    // ‡¶∏‡¶¨ section hide ‡¶ï‡¶∞‡ßã
    document.querySelectorAll('.section').forEach(sec => {
      sec.classList.remove('active');
    });
    // ‡¶Ø‡ßá section ‡¶ö‡¶æ‡¶á ‡¶∏‡ßá‡¶ü‡¶æ‡¶ï‡ßá active ‡¶ï‡¶∞‡ßã
    document.getElementById(sectionId).classList.add('active');
    
    // üëâ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶¨‡¶®‡ßç‡¶ß ‡¶∞‡¶æ‡¶ñ‡¶§‡ßá ‡¶è‡¶á ‡¶≤‡¶æ‡¶á‡¶®‡¶ü‡¶ø ‡¶¶‡ßá‡¶¨‡ßá
    // window.scrollTo(0,0); // ‡¶Ø‡¶¶‡¶ø ‡¶â‡¶™‡¶∞‡ßá ‡¶Ø‡ßá‡¶§‡ßá ‡¶ö‡¶æ‡¶ì
    // ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶á ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ‡•§ ‡¶ï‡ßã‡¶®‡ßã scrollIntoView ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã ‡¶®‡¶æ‡•§
  }
  
  // Navigation button ‡¶è ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü
  document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault(); // ‚úÖ default scrolling ‡¶¨‡¶®‡ßç‡¶ß
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      const sec = this.dataset.section;
      showSection(sec);
    });
  });
</script>
<script>
  // ‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤‡¶ü‡¶æ‡¶á‡¶Æ‡ßá ‡¶∂‡ßã ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
  const emergencyNumberEl = document.getElementById('emergencyNumber');
  
  db.ref('emergency_contact').on('value', (snapshot) => {
    const number = snapshot.val();
    if (number) {
      emergencyNumberEl.textContent = `‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßá ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®: ${number}`;
    } else {
      emergencyNumberEl.textContent = '‡¶∞‡¶ï‡ßç‡¶§‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßá ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®: ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø';
    }
  });
</script>
<script>
  // ---- Firebase ‡¶•‡ßá‡¶ï‡ßá Hero Section ‡¶è‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ----
  const heroTitleEl = document.querySelector('.hero-title');
  const heroSubtitleEl = document.querySelector('.hero-subtitle');
  
  db.ref("heroSection").on("value", (snapshot) => {
    const data = snapshot.val();
    if (!data) return;
    
    // Title & Subtitle set
    if (data.title) heroTitleEl.textContent = data.title;
    if (data.subtitle) heroSubtitleEl.textContent = data.subtitle;
    
    // Animated text ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶≤‡ßã‡¶°
    if (data.texts) {
      heroTexts.length = 0; // ‡¶Ü‡¶ó‡ßá‡¶∞ array ‡¶ñ‡¶æ‡¶≤‡¶ø
      Object.values(data.texts).forEach(t => heroTexts.push(t));
      currentTextIndex = 0; // ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ
      animateTextChange();
    }
  });
</script>
<script>
  const popup = document.getElementById('founderPopup');
  const closeBtn = document.getElementById('closePopup');
  const founderPhoto = document.getElementById('founderPhoto');
  const founderName = document.getElementById('founderName');
  const founderDescription = document.getElementById('founderDescription');
  const founderContact = document.getElementById('founderContact');

  // Fetch founder info from Firebase
  firebase.database().ref('founderInformation').once('value').then(snapshot=>{
    const data = snapshot.val();
    if(data){
      founderPhoto.src = data.image || "";
      founderName.textContent = data.name || "-";
      founderDescription.textContent = data.description || "";
      founderContact.textContent = data.contact || "-";

      // Show popup automatically
      popup.style.display = "flex";
    }
  }).catch(err=>{
    console.error("Failed to load founder info:", err);
  });

  // Close popup
  closeBtn.addEventListener('click', ()=>{ popup.style.display = "none"; });
  popup.addEventListener('click', (e)=>{ if(e.target === popup) popup.style.display = "none"; });
</script>
</body>
</html>