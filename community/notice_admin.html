<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>রক্তদান - নোটিস অ্যাডমিন প্যানেল</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
  /* ========= Base ========= */
  :root{
    --primary: #d32f2f;
    --primary-dark: #b71c1c;
    --primary-light: #ff6659;
    --secondary: #1976d2;
    --danger: #c62828;
    --success: #2e7d32;
    --warning: #f57c00;
    --muted: #757575;
    --card-bg: #ffffff;
    --bg: #fbe9e7;
    --radius: 12px;
    --glass: rgba(255,255,255,0.7);
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:'Noto Sans Bengali',sans-serif}
  body{background: linear-gradient(to bottom, #fbe9e7, #ffccbc); color:#333; min-height:100vh;}

  /* ========= Layout ========= */
  .container{max-width:1200px;margin:0 auto;padding:0 20px;}
  
  /* ========= Header ========= */
  .header {
    background: linear-gradient(135deg, rgba(211, 47, 47, 0.9), rgba(183, 28, 28, 0.85));
    color: white;
    padding: 20px;
    text-align: center;
    margin-bottom: 30px;
    border-radius: 0 0 20px 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
  }
  
  .header h1 {
    font-size: 2.2rem;
    margin-bottom: 10px;
  }
  
  .header p {
    opacity: 0.9;
  }
  
  /* ========= Cards ========= */
  .card{
    background: var(--card-bg); 
    border-radius: var(--radius); 
    padding: 20px; 
    box-shadow: 0 8px 20px rgba(211, 47, 47, 0.12);
    overflow:hidden;
    margin-bottom: 20px;
    border-left: 4px solid var(--primary);
    transition: all 0.3s ease;
  }
  
  .card h2 {
    color: var(--primary-dark);
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(211, 47, 47, 0.2);
  }

  /* ========= Form Styles ========= */
  .form-group {
    margin-bottom: 15px;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: var(--primary-dark);
  }
  
  .form-control {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid rgba(211, 47, 47, 0.3);
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.3s ease;
  }
  
  .form-control:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.2);
  }
  
  textarea.form-control {
    min-height: 120px;
    resize: vertical;
  }
  
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .btn-primary {
    background: var(--primary);
    color: white;
  }
  
  .btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(183, 28, 28, 0.3);
  }
  
  .btn-danger {
    background: var(--danger);
    color: white;
  }
  
  .btn-danger:hover {
    background: #b71c1c;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(183, 28, 28, 0.3);
  }
  
  .btn-secondary {
    background: var(--muted);
    color: white;
  }
  
  .btn-secondary:hover {
    background: #616161;
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(97, 97, 97, 0.3);
  }

  /* ========= Notice List ========= */
  .notice-list {
    margin-top: 20px;
  }
  
  .notice-item {
    background: rgba(255, 249, 196, 0.5);
    border-left: 4px solid #ffc107;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
  }
  
  .notice-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.1);
  }
  
  .notice-title {
    font-weight: 600;
    color: #7d6608;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .notice-content {
    color: #8d6e10;
    font-size: 14px;
    margin-bottom: 10px;
  }
  
  .notice-date {
    font-size: 12px;
    color: #b2a05d;
    text-align: right;
  }
  
  .notice-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }
  
  /* ========= Alert Styles ========= */
  .alert {
    padding: 12px 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .alert-success {
    background-color: #e6ffef;
    color: #046a3b;
    border: 1px solid #bff7d0;
  }
  
  .alert-error {
    background-color: #ffecec;
    color: #7a1515;
    border: 1px solid #f4b6b6;
  }
  
  /* ========= Utility Classes ========= */
  .text-right {
    text-align: right;
  }
  
  .mt-20 {
    margin-top: 20px;
  }
  
  .mb-20 {
    margin-bottom: 20px;
  }
  
  /* ========= Responsive Styles ========= */
  @media (max-width: 768px) {
    .container {
      padding: 0 15px;
    }
    
    .header h1 {
      font-size: 1.8rem;
    }
    
    .notice-actions {
      flex-direction: column;
    }
  }
</style>
</head>
<body>

<!-- ===== HEADER ===== -->
<div class="header">
  <h1><i class="fa-solid fa-bullhorn"></i> রক্তদান নোটিস অ্যাডমিন প্যানেল</h1>
  <p>এখান থেকে নোটিস ম্যানেজ করুন যা ইউজার ড্যাশবোর্ডে দেখানো হবে</p>
</div>

<!-- ===== MAIN CONTAINER ===== -->
<div class="container">
  <!-- Alert Container -->
  <div id="alertContainer"></div>
  
  <!-- Add Notice Form -->
  <div class="card">
    <h2><i class="fa-solid fa-plus"></i> নতুন নোটিস যোগ করুন</h2>
    <form id="noticeForm">
      <div class="form-group">
        <label for="noticeTitle">নোটিসের শিরোনাম</label>
        <input type="text" id="noticeTitle" class="form-control" placeholder="নোটিসের শিরোনাম লিখুন" required>
      </div>
      
      <div class="form-group">
        <label for="noticeContent">নোটিসের বিস্তারিত</label>
        <textarea id="noticeContent" class="form-control" placeholder="নোটিসের বিস্তারিত লিখুন" required></textarea>
      </div>
      
      <div class="text-right">
        <button type="submit" class="btn btn-primary"><i class="fa-solid fa-paper-plane"></i> নোটিস প্রকাশ করুন</button>
      </div>
    </form>
  </div>
  
  <!-- Notices List -->
  <div class="card">
    <h2><i class="fa-solid fa-list"></i> সমস্ত নোটিস</h2>
    <div id="noticesList" class="notice-list">
      <!-- Notices will be loaded here -->
    </div>
  </div>
</div>

<script>
  // ===== Firebase Config =====
  const firebaseConfig = {
    apiKey: "AIzaSyAqhLfmOfmP-_8DOcoEH7Ck7fMF9Id4vJ4",
    authDomain: "earn-project-5f892.firebaseapp.com",
    databaseURL: "https://earn-project-5f892-default-rtdb.firebaseio.com/",
    projectId: "earn-project-5f892",
    storageBucket: "earn-project-5f892.firebasestorage.app",
    messagingSenderId: "8457886057",
    appId: "1:8457886057:web:b5e01d0972d169f47085f8"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // DOM references
  const noticeForm = document.getElementById('noticeForm');
  const noticesList = document.getElementById('noticesList');
  const alertContainer = document.getElementById('alertContainer');

  // Show alert message
  function showAlert(message, type = 'success') {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type === 'success' ? 'success' : 'error'}`;
    alertDiv.innerHTML = `
      <i class="fa-solid ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
      ${message}
    `;
    
    alertContainer.appendChild(alertDiv);
    
    // Remove alert after 5 seconds
    setTimeout(() => {
      alertDiv.remove();
    }, 5000);
  }

  // Format date
  function formatDate(dateString) {
    const date = new Date(dateString);
    const options = { 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    };
    return date.toLocaleDateString('bn-BD', options);
  }

  // Load notices from Firebase
  function loadNotices() {
    const noticesRef = db.ref('notices').orderByChild('date');
    noticesRef.on('value', snapshot => {
      noticesList.innerHTML = '';
      
      if (!snapshot.exists()) {
        noticesList.innerHTML = `
          <div class="notice-item">
            <div class="notice-title"><i class="fa-solid fa-info-circle"></i> কোন নোটিশ নেই</div>
            <div class="notice-content">বর্তমানে কোন নোটিশ নেই। নতুন নোটিশ যোগ করুন।</div>
          </div>
        `;
        return;
      }
      
      const notices = [];
      snapshot.forEach(childSnapshot => {
        notices.push({ id: childSnapshot.key, ...childSnapshot.val() });
      });
      
      // Sort by date descending
      notices.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      notices.forEach(notice => {
        const noticeElement = document.createElement('div');
        noticeElement.className = 'notice-item';
        noticeElement.innerHTML = `
          <div class="notice-title"><i class="fa-solid fa-bullhorn"></i> ${notice.title}</div>
          <div class="notice-content">${notice.content}</div>
          <div class="notice-date">প্রকাশের তারিখ: ${formatDate(notice.date)}</div>
          <div class="notice-actions">
            <button class="btn btn-secondary" onclick="editNotice('${notice.id}')">
              <i class="fa-solid fa-edit"></i> সম্পাদনা
            </button>
            <button class="btn btn-danger" onclick="deleteNotice('${notice.id}')">
              <i class="fa-solid fa-trash"></i> মুছুন
            </button>
          </div>
        `;
        noticesList.appendChild(noticeElement);
      });
    });
  }

  // Add new notice
  noticeForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const title = document.getElementById('noticeTitle').value;
    const content = document.getElementById('noticeContent').value;
    
    if (!title || !content) {
      showAlert('দয়া করে নোটিশের শিরোনাম এবং বিস্তারিত লিখুন', 'error');
      return;
    }
    
    const newNoticeRef = db.ref('notices').push();
    newNoticeRef.set({
      title: title,
      content: content,
      date: new Date().toISOString()
    })
    .then(() => {
      showAlert('নোটিশ সফলভাবে যোগ করা হয়েছে!');
      noticeForm.reset();
    })
    .catch(error => {
      showAlert('নোটিশ যোগ করতে সমস্যা হয়েছে: ' + error.message, 'error');
    });
  });

  // Edit notice
  function editNotice(noticeId) {
    const noticeRef = db.ref('notices/' + noticeId);
    noticeRef.once('value')
      .then(snapshot => {
        const notice = snapshot.val();
        
        document.getElementById('noticeTitle').value = notice.title;
        document.getElementById('noticeContent').value = notice.content;
        
        // Change form to update mode
        const submitButton = noticeForm.querySelector('button[type="submit"]');
        submitButton.innerHTML = '<i class="fa-solid fa-save"></i> নোটিশ আপডেট করুন';
        submitButton.dataset.editing = noticeId;
        
        // Scroll to form
        noticeForm.scrollIntoView({ behavior: 'smooth' });
        
        showAlert('নোটিশ সম্পাদনার জন্য প্রস্তুত। আপডেট করুন অথবা বাতিল করতে Esc চাপুন।');
      })
      .catch(error => {
        showAlert('নোটিশ লোড করতে সমস্যা হয়েছে: ' + error.message, 'error');
      });
  }

  // Delete notice
  function deleteNotice(noticeId) {
    if (confirm('আপনি কি এই নোটিশটি মুছতে চান?')) {
      db.ref('notices/' + noticeId).remove()
        .then(() => {
          showAlert('নোটিশ সফলভাবে মুছে ফেলা হয়েছে!');
        })
        .catch(error => {
          showAlert('নোটিশ মুছতে সমস্যা হয়েছে: ' + error.message, 'error');
        });
    }
  }

  // Handle form for both add and update
  noticeForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const title = document.getElementById('noticeTitle').value;
    const content = document.getElementById('noticeContent').value;
    const submitButton = noticeForm.querySelector('button[type="submit"]');
    const isEditing = submitButton.dataset.editing;
    
    if (!title || !content) {
      showAlert('দয়া করে নোটিশের শিরোনাম এবং বিস্তারিত লিখুন', 'error');
      return;
    }
    
    if (isEditing) {
      // Update existing notice
      db.ref('notices/' + isEditing).update({
        title: title,
        content: content,
        date: new Date().toISOString()
      })
      .then(() => {
        showAlert('নোটিশ সফলভাবে আপডেট করা হয়েছে!');
        noticeForm.reset();
        
        // Reset form to add mode
        submitButton.innerHTML = '<i class="fa-solid fa-paper-plane"></i> নোটিশ প্রকাশ করুন';
        delete submitButton.dataset.editing;
      })
      .catch(error => {
        showAlert('নোটিশ আপডেট করতে সমস্যা হয়েছে: ' + error.message, 'error');
      });
    } else {
      // Add new notice
      const newNoticeRef = db.ref('notices').push();
      newNoticeRef.set({
        title: title,
        content: content,
        date: new Date().toISOString()
      })
      .then(() => {
        showAlert('নোটিশ সফলভাবে যোগ করা হয়েছে!');
        noticeForm.reset();
      })
      .catch(error => {
        showAlert('নোটিশ যোগ করতে সমস্যা হয়েছে: ' + error.message, 'error');
      });
    }
  });

  // Cancel edit on Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const submitButton = noticeForm.querySelector('button[type="submit"]');
      if (submitButton.dataset.editing) {
        noticeForm.reset();
        submitButton.innerHTML = '<i class="fa-solid fa-paper-plane"></i> নোটিশ প্রকাশ করুন';
        delete submitButton.dataset.editing;
        showAlert('সম্পাদনা বাতিল করা হয়েছে।');
      }
    }
  });

  // Initialize the page
  loadNotices();
</script>

</body>
</html>